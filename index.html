<!doctype html> 
<html lang="en"> 
<head> 
	<meta charset="UTF-8" />
    <title>Orbiting</title>
    <!--<script src="//cdn.jsdelivr.net/npm/phaser-ce@2.9.4/build/phaser.min.js"></script>-->
    <script src="lib/phaser.min.js"></script>
    <script src="lib/Orbit.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>

<script type="text/javascript">


var game = new Phaser.Game(800, 800, Phaser.AUTO, '', { preload: preload, create: create, update: update, render: render });

function preload() {
    game.load.image('planet', 'assets/water0.png');
    game.load.image('ship', 'assets/aerie.png');
}

var planet;
var ship;

var orbit;

var axis1;
var axis2;

var path;

function create() {

    //game.stage.backgroundColor = "#000000";
    game.world.setBounds(-2000, -2000, 4000, 4000);

    path = game.add.graphics(0,0);
    
    planet = game.add.sprite(0, 0, 'planet');
    planet.anchor.set(0.5);
    planet.scale.set(2);

    ship = game.add.sprite(0,300, 'ship');
    ship.anchor.set(0.5);
    ship.scale.set(0.5);

    var vel = Math.sqrt( ( 0.1 * 10 ) / 300 );
    orbit = new Orbit( 0.1, 10, 0, 0, 300, Math.PI *0.5, vel*0.9, Math.PI*0.1 );


    const period = orbit.getPeriod();
    const step = period / 100.0;

    let pos = orbit.getPositionOfSecondary(0);
    path.moveTo(pos.x, pos.y);
    path.lineStyle(10, 0xFFFFFF, 0.25);

    for(let t=0; t<=100; t++) {
        pos = orbit.getPositionOfSecondary(step*t);
        path.lineTo(pos.x, pos.y);
    }


    //  Our controls.
    cursors = game.input.keyboard.createCursorKeys();

    var p1 = orbit.getPointOnEllipse(0);
    var p2 = orbit.getPointOnEllipse(Math.PI);
    axis1 = new Phaser.Line(p1.x, p1.y, p2.x, p2.y);

    p1 = orbit.getPointOnEllipse(Math.PI*0.5);
    p2 = orbit.getPointOnEllipse(Math.PI*-0.5);
    axis2 = new Phaser.Line(p1.x, p1.y, p2.x, p2.y);

    

    game.camera.follow(ship);
}

function dist(p1, p2) {
    const a = p2.x - p1.x;
    const b = p2.y - p1.y;
    return Math.sqrt(a*a + b*b);
}

function update() {
    var pos = orbit.getPositionOfSecondary(game.time.totalElapsedSeconds() * 1000);
    ship.x = pos.x;
    ship.y = pos.y;
}

function render() {
    game.debug.geom(axis1);
    game.debug.geom(axis2);

    game.debug.cameraInfo(game.camera, 500, 32);
    game.debug.spriteInfo(ship, 32, 32);
}

</script>

</body>
</html>